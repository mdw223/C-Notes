// Demonstration of the limits on the number of files you can open.
// This program keeps opening more and more fiels until it can't open
// This sort of shows why file leaks are bad.

#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

int main( int argc, char *argv[] )
{
  int count = 0;

  while ( true ) {
    // Make up a file name.
    char name[ 100 ];
    sprintf( name, "dummy_%04d.txt", count );
    
    // Open a file for output (but we never use it)
    FILE *fp = fopen( name, "w" );

    // Report success, or report failure and exit.
    if ( fp == NULL ) {
      printf( "Failed after opening %d files\n", count );
      return 0;
    } else {
      count++;
      printf( "Successfully opened file %d\n", count );
    }
  }

  return 0;
}
